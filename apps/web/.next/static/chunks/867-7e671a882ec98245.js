"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{5125:function(e,t,r){r.d(t,{Vm:function(){return o},aC:function(){return g},eE:function(){return y},L8:function(){return p},qr:function(){return l},Id:function(){return d},Wq:function(){return i}});var a=r(7582),s=r(4452);let n={user:{id:null,name:null,email:null},isLoading:!1,theme:"light"},l=(0,a.Ue)()((0,s.mW)((0,s.tJ)(e=>({...n,setUser:t=>e(e=>({user:{...e.user,...t}}),!1,"setUser"),setLoading:t=>e({isLoading:t},!1,"setLoading"),setTheme:t=>e({theme:t},!1,"setTheme"),reset:()=>e(n,!1,"reset")}),{name:"melog-app-store",partialize:e=>({theme:e.theme})}),{name:"app-store"})),c={entries:[],currentEntry:null,isRecording:!1},i=(0,a.Ue)()((0,s.mW)((0,s.tJ)((e,t)=>({...c,addEntry:t=>e(e=>({entries:[...e.entries,{...t,id:"emotion_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:new Date}]}),!1,"addEntry"),updateEntry:(t,r)=>e(e=>({entries:e.entries.map(e=>e.id===t?{...e,...r}:e)}),!1,"updateEntry"),deleteEntry:t=>e(e=>({entries:e.entries.filter(e=>e.id!==t)}),!1,"deleteEntry"),setCurrentEntry:t=>e({currentEntry:t},!1,"setCurrentEntry"),setRecording:t=>e({isRecording:t},!1,"setRecording"),getEntriesByDateRange:(e,r)=>{let{entries:a}=t();return a.filter(t=>t.timestamp>=e&&t.timestamp<=r)}}),{name:"melog-emotion-store",storage:{getItem:e=>{var t;let r=localStorage.getItem(e);if(!r)return null;let{state:a}=JSON.parse(r);return{state:{...a,entries:(null===(t=a.entries)||void 0===t?void 0:t.map(e=>({...e,timestamp:new Date(e.timestamp)})))||[]}}},setItem:(e,t)=>{var r;let{state:a}=t;localStorage.setItem(e,JSON.stringify({state:{...a,entries:(null===(r=a.entries)||void 0===r?void 0:r.map(e=>({...e,timestamp:e.timestamp.toISOString()})))||[]}}))},removeItem:e=>localStorage.removeItem(e)}}),{name:"emotion-store"})),o={joy:{name:"기쁨",color:"#FFD700",icon:"\uD83D\uDE0A",darkColor:"#FFA500"},sadness:{name:"슬픔",color:"#4169E1",icon:"\uD83D\uDE22",darkColor:"#1E90FF"},anger:{name:"분노",color:"#DC143C",icon:"\uD83D\uDE20",darkColor:"#FF6347"},fear:{name:"두려움",color:"#8A2BE2",icon:"\uD83D\uDE28",darkColor:"#9370DB"},surprise:{name:"놀람",color:"#FF69B4",icon:"\uD83D\uDE32",darkColor:"#FF1493"},disgust:{name:"혐오",color:"#32CD32",icon:"\uD83E\uDD22",darkColor:"#228B22"}};var u=r(7653);let d=()=>{let[e,t]=(0,u.useState)(!1),[r,a]=(0,u.useState)(!1),[s,n]=(0,u.useState)(0),[l,c]=(0,u.useState)(null),[i,o]=(0,u.useState)(null),[d,m]=(0,u.useState)(""),[x,f]=(0,u.useState)(!1),[h,b]=(0,u.useState)(""),g=(0,u.useRef)(null),p=(0,u.useRef)(null),y=(0,u.useRef)(null),v=(0,u.useRef)([]),D=(0,u.useRef)(null),w=(0,u.useRef)(!1),j=(0,u.useCallback)(()=>{y.current=setInterval(()=>{n(e=>e>=60?(I(),60):e+1)},1e3)},[]),N=(0,u.useCallback)(()=>{y.current&&(clearInterval(y.current),y.current=null)},[]),C=(0,u.useCallback)(()=>{let t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){w.current=!1;return}w.current=!0,D.current=new t;let a=D.current;a.continuous=!0,a.interimResults=!0,a.lang="ko-KR",a.onstart=()=>{f(!0),o(null)},a.onresult=e=>{let t="",r="";for(let a=e.resultIndex;a<e.results.length;a++){let s=e.results[a][0].transcript;e.results[a].isFinal?r+=s:t+=s}r&&(m(e=>(e?"".concat(e," ").concat(r):r).trim()),b("")),t&&b(t)},a.onerror=e=>{console.error("음성 인식 오류:",e.error),"no-speech"!==e.error&&"audio-capture"!==e.error&&o("음성 인식 오류: ".concat(e.error))},a.onend=()=>{if(f(!1),b(""),e&&!r&&w.current)try{a.start()}catch(e){console.warn("음성 인식 재시작 실패:",e)}}},[e,r]),k=(0,u.useCallback)(()=>{if(D.current&&w.current)try{D.current.start()}catch(e){console.warn("음성 인식 시작 실패:",e)}},[]),S=(0,u.useCallback)(()=>{if(D.current&&w.current)try{D.current.stop()}catch(e){console.warn("음성 인식 정지 실패:",e)}f(!1),b("")},[]),E=(0,u.useCallback)(async()=>{try{o(null),m(""),b(""),C();let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});p.current=e,v.current=[];let r=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});g.current=r,r.ondataavailable=e=>{e.data.size>0&&v.current.push(e.data)},r.onstop=()=>{let e=new Blob(v.current,{type:"audio/webm;codecs=opus"});c(e),S(),p.current&&(p.current.getTracks().forEach(e=>e.stop()),p.current=null)},r.start(),t(!0),a(!1),j(),setTimeout(()=>{k()},500)}catch(e){console.error("녹음 시작 오류:",e),o("마이크 접근 권한이 필요합니다.")}},[j,C,k,S]),I=(0,u.useCallback)(()=>{g.current&&"inactive"!==g.current.state&&g.current.stop(),S(),t(!1),a(!1),N()},[N,S]),R=(0,u.useCallback)(()=>{g.current&&"recording"===g.current.state&&(g.current.pause(),a(!0),N(),S())},[N,S]),T=(0,u.useCallback)(()=>{g.current&&"paused"===g.current.state&&(g.current.resume(),a(!1),j(),setTimeout(()=>{k()},200))},[j,k]),A=(0,u.useCallback)(()=>{I(),n(0),c(null),o(null),m(""),b(""),v.current=[]},[I]),F=(0,u.useCallback)(e=>{m(e)},[]),P=(0,u.useCallback)(async()=>{if(l)try{let e=new Audio;e.src=URL.createObjectURL(l),await e.play()}catch(e){console.error("재생 오류:",e),o("오디오 재생에 실패했습니다.")}},[l]);return(0,u.useEffect)(()=>()=>{N(),p.current&&p.current.getTracks().forEach(e=>e.stop())},[N]),{isRecording:e,isPaused:r,recordingTime:s,audioBlob:l,error:i,realtimeText:d,isListening:x,interimText:h,startRecording:E,stopRecording:I,pauseRecording:R,resumeRecording:T,resetRecording:A,playRecording:P,updateRealtimeText:F}};var m=r(4859);let x={apiUrl:m.env.NEXT_PUBLIC_STT_URL||"/api/stt",apiKey:m.env.NEXT_PUBLIC_STT_API_KEY||"",language:"ko-KR",maxRetries:3},f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio.webm",r=new FormData;return r.append("audio",e,t),r.append("language",x.language),r},h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={...x,...t};try{let t=f(e),a=await fetch(r.apiUrl,{method:"POST",headers:{...r.apiKey&&{Authorization:"Bearer ".concat(r.apiKey)}},body:t});if(!a.ok)throw Error("STT API 오류: ".concat(a.status," ").concat(a.statusText));let s=await a.json();return{success:!0,text:s.text||s.transcript||"",confidence:s.confidence}}catch(e){return console.error("STT 변환 오류:",e),{success:!1,text:"",error:e instanceof Error?e.message:"음성 인식에 실패했습니다."}}},b=async e=>new Promise(e=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){e({success:!1,text:"",error:"Web Speech API를 지원하지 않는 브라우저입니다."});return}try{e({success:!1,text:"",error:"STT API 설정이 필요합니다."})}catch(t){e({success:!1,text:"",error:"Web Speech API 오류가 발생했습니다."})}}),g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={...x,...t};for(let a=1;a<=r.maxRetries;a++)try{let s=await h(e,t);if(s.success)return s;s.error,a<r.maxRetries&&await new Promise(e=>setTimeout(e,1e3*a))}catch(e){e instanceof Error&&e.message,a<r.maxRetries&&await new Promise(e=>setTimeout(e,1e3*a))}return console.warn("STT API 재시도 모두 실패, fallback 사용"),b(e)},p=["조금","조금 많이","적당히","많이","매우"],y=[{name:"기쁨",colors:["#fff1d3","#ffeabc","#ffe09c","#ffdc8f","#f3c96b"]},{name:"슬픔",colors:["#b5defe","#7dc5fe","#70bffe","#40a6f7","#2196f3"]},{name:"분노",colors:["#ffcdd2","#ef9a9a","#e57373","#ef5350","#f44336"]},{name:"평온",colors:["#c8e6c9","#a5d6a7","#81c784","#66bb6a","#4caf50"]},{name:"설렘",colors:["#f3e5f5","#e1bee7","#ce93d8","#ba68c8","#ab47bc"]},{name:"지침",colors:["#fff3e0","#ffe0b2","#ffcc80","#ffb74d","#ff9800"]}]},6867:function(e,t,r){r.d(t,{hn:function(){return p},zx:function(){return o},II:function(){return m},Ar:function(){return g}});var a=r(7573),s=r(607),n=r(5579);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}let c={primary:"bg-blue-600 hover:bg-blue-700 text-white",secondary:"bg-gray-600 hover:bg-gray-700 text-white",outline:"border border-gray-300 hover:bg-gray-50 text-gray-700",ghost:"hover:bg-gray-100 text-gray-700"},i={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"};function o(e){let{children:t,className:r,variant:s="primary",size:n="md",isLoading:o=!1,disabled:u,...d}=e;return(0,a.jsxs)("button",{className:l("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 disabled:pointer-events-none disabled:opacity-50",c[s],i[n],r),disabled:u||o,...d,children:[o&&(0,a.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t]})}var u=r(7653);let d=(0,u.forwardRef)((e,t)=>{let{className:r,label:s,error:n,helperText:c,...i}=e;return(0,a.jsxs)("div",{className:"w-full",children:[s&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),(0,a.jsx)("input",{className:l("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n&&"border-red-500 focus-visible:ring-red-500",r),ref:t,...i}),n&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:n}),c&&!n&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:c})]})});d.displayName="Input";var m=d,x=r(5125),f=r(1695);let h=[{id:"home",label:"홈",icon:"\uD83C\uDFE0",activeIcon:"\uD83C\uDFE0",path:"/"},{id:"feed",label:"피드",icon:"\uD83D\uDCCA",activeIcon:"\uD83D\uDCCA",path:"/feed"},{id:"calendar",label:"캘린더",icon:"\uD83D\uDCC5",activeIcon:"\uD83D\uDCC5",path:"/calendar"},{id:"profile",label:"마이",icon:"\uD83D\uDC64",activeIcon:"\uD83D\uDC64",path:"/profile"}];function b(e){let{className:t=""}=e,r=(0,f.useRouter)(),s=(0,f.usePathname)(),n=e=>{s!==e&&r.push(e)};return(0,a.jsxs)("div",{className:"fixed bottom-0 left-1/2 transform -translate-x-1/2 w-[384px] bg-white border-t border-gray-200 shadow-lg ".concat(t),children:[(0,a.jsx)("div",{className:"flex items-center justify-around py-2",children:h.map(e=>{let t=s===e.path;return(0,a.jsxs)("button",{onClick:()=>n(e.path),className:"flex flex-col items-center justify-center py-2 px-3 min-w-0 flex-1 transition-all duration-200 relative ".concat(t?"text-blue-600":"text-gray-500 hover:text-gray-700 active:text-blue-500"),children:[(0,a.jsx)("div",{className:"text-xl mb-1 transition-transform duration-200 ".concat(t?"scale-110":"scale-100"),children:t?e.activeIcon:e.icon}),(0,a.jsx)("span",{className:"text-xs font-medium transition-colors duration-200 ".concat(t?"text-blue-600":"text-gray-500"),children:e.label}),t&&(0,a.jsx)("div",{className:"absolute bottom-0 w-6 h-0.5 bg-blue-600 rounded-t-full"})]},e.id)})}),(0,a.jsx)("div",{className:"flex justify-center pb-2",children:(0,a.jsx)("div",{className:"w-32 h-1 bg-gray-300 rounded-full"})})]})}function g(e){let{children:t,className:r="",showTabBar:s=!0}=e,{theme:n}=(0,x.qr)();return(0,a.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,a.jsxs)("div",{className:"mx-auto w-[384px] bg-white min-h-screen shadow-xl relative",children:[(0,a.jsx)("div",{className:"min-h-screen transition-colors duration-300 ".concat("dark"===n?"dark bg-gray-900":"bg-white"," ").concat(r),children:(0,a.jsx)("main",{className:"px-4 w-full ".concat(s?"pb-20":""),children:t})}),s&&(0,a.jsx)(b,{}),(0,a.jsx)("div",{className:"hidden lg:block absolute -left-4 top-0 w-1 h-full bg-gray-300 opacity-30"}),(0,a.jsx)("div",{className:"hidden lg:block absolute -right-4 top-0 w-1 h-full bg-gray-300 opacity-30"})]})})}function p(e){let{onTranscriptionComplete:t,onError:r,maxDuration:s=60,className:n=""}=e,[l,c]=(0,u.useState)(!1),[i,d]=(0,u.useState)(""),{isRecording:m,isPaused:f,recordingTime:h,audioBlob:b,error:g,realtimeText:p,isListening:y,interimText:v,startRecording:D,stopRecording:w,pauseRecording:j,resumeRecording:N,resetRecording:C,playRecording:k,updateRealtimeText:S}=(0,x.Id)(),E=e=>"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0")),I=h/s*100,R=async()=>{if(p.trim()){d(p.trim()),null==t||t(p.trim());return}if(b){c(!0),d("");try{let e=await (0,x.aC)(b);if(e.success&&e.text)d(e.text),null==t||t(e.text);else{let t=e.error||"음성 인식에 실패했습니다.";null==r||r(t)}}catch(e){null==r||r("음성 인식 중 오류가 발생했습니다.")}finally{c(!1)}}},T=e=>{S(e.target.value)};return(0,a.jsxs)("div",{className:"w-full space-y-4 ".concat(n),children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-800 mb-1",children:"음성 메모"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["최대 ",s,"초까지 녹음할 수 있어요"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(I>90?"bg-red-500":I>70?"bg-yellow-500":"bg-blue-500"),style:{width:"".concat(Math.min(I,100),"%")}})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("span",{className:"text-2xl font-mono ".concat(h>.9*s?"text-red-500":"text-gray-700"),children:E(h)}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["/ ",E(s)]})]}),m&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-red-500",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:f?"일시정지됨":"녹음 중..."}),y&&(0,a.jsx)("span",{className:"text-xs text-blue-600 ml-2",children:"\uD83C\uDFA4 인식 중"})]}),(p||v)&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-xs text-blue-700 mb-1",children:"\uD83D\uDDE3️ 실시간 인식 내용"}),(0,a.jsx)("textarea",{value:p,onChange:T,className:"w-full bg-transparent text-sm text-blue-800 resize-none border-none outline-none",placeholder:"음성이 인식되면 여기에 표시됩니다...",rows:Math.max(2,Math.ceil(p.length/30))}),v&&(0,a.jsxs)("div",{className:"text-xs text-blue-500 italic opacity-70 mt-1",children:[v,"..."]})]})]}),(0,a.jsx)("div",{className:"space-y-3",children:b?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(o,{onClick:k,variant:"outline",className:"flex-1",disabled:l,children:"▶️ 재생"}),(0,a.jsx)(o,{onClick:()=>{C(),d("")},variant:"outline",className:"flex-1",disabled:l,children:"\uD83D\uDD04 다시 녹음"})]}),(0,a.jsx)(o,{onClick:R,className:"w-full",disabled:l,isLoading:l,children:l?"음성 인식 중...":p.trim()?"\uD83D\uDCDD 실시간 텍스트 사용":"\uD83D\uDCDD 텍스트로 변환"})]}):(0,a.jsx)("div",{className:"flex space-x-2",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o,{onClick:f?N:j,variant:"outline",className:"flex-1",children:f?"▶️ 재개":"⏸️ 일시정지"}),(0,a.jsx)(o,{onClick:w,variant:"secondary",className:"flex-1",children:"⏹️ 정지"})]}):(0,a.jsx)(o,{onClick:D,className:"flex-1",disabled:l,children:"\uD83C\uDFA4 녹음 시작"})})}),g&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,a.jsxs)("p",{className:"text-sm text-red-700 text-center",children:["⚠️ ",g]})}),i&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"\uD83D\uDCDD 변환된 텍스트:"}),(0,a.jsx)("p",{className:"text-sm text-green-700",children:i})]}),!m&&!b&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,a.jsx)("p",{className:"text-xs text-blue-700 text-center",children:"\uD83D\uDCA1 마이크 접근 권한을 허용해주세요. 녹음하면 실시간으로 말하는 내용이 텍스트로 변환됩니다."})}),!m&&b&&p&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"\uD83D\uDDE3️ 실시간 인식 결과:"}),(0,a.jsx)("textarea",{value:p,onChange:T,className:"w-full bg-white border border-green-300 rounded p-2 text-sm text-green-700 resize-none",rows:Math.max(2,Math.ceil(p.length/30))}),(0,a.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"✏️ 내용을 수정할 수 있습니다."})]})]})}}}]);